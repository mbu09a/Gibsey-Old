# Week 7 — Day 48 (Beta Wait‑List Landing Page)

> **Target session:** ≈ 2 h  **Goal:** add a public landing page under `/beta` that collects email addresses into a Supabase `waitlist` table. Protect the form with Cloudflare Turnstile (free bot mitigation) and show a confirmation screen. No login required.
>
> **Outcome:** Visiting `https://alpha.gibsey.com/beta` shows a sleek sign‑up page; submitting a valid email passes Turnstile, stores row in DB, and displays “You’re on the list 🎉”. The page is SEO‑indexed and share‑ready.

---

\## 1 · Database – `waitlist` table

```sql
create table if not exists waitlist (
  id          bigint generated by default as identity primary key,
  email       text unique not null,
  ts          timestamptz default now(),
  referral    text
);
```

Enable **RLS OFF** (public insert) but add email uniqueness.

---

\## 2 · Cloudflare Turnstile keys

1. Go to [https://dash.cloudflare.com/turnstile](https://dash.cloudflare.com/turnstile) → **Add Site** → Domain `alpha.gibsey.com` → Widget Type *Managed*.
2. Copy **Site Key** & **Secret Key**.
3. Add to Fly secrets on front‑end app:

```bash
fly secrets set VITE_TURNSTILE_SITE_KEY=... TURNSTILE_SECRET_KEY=...
```

Add `TURNSTILE_SECRET_KEY` to backend secrets as well for verification.

---

\## 3 · Backend – verify token endpoint
`app/routes/waitlist.py`:

```python
class WaitRequest(BaseModel):
    email: EmailStr
    token: str
    referral: str|None=None

@app.post("/waitlist")
async def join_wait(req: WaitRequest):
    # verify Turnstile
    resp = requests.post("https://challenges.cloudflare.com/turnstile/v0/siteverify", data={
        "secret": os.getenv("TURNSTILE_SECRET_KEY"),
        "response": req.token
    }).json()
    if not resp.get("success"):
        raise HTTPException(400, "Captcha failed")
    sb.table("waitlist").upsert({"email": req.email, "referral": req.referral}).execute()
    return {"ok": True}
```

No auth dependency; CORS already allows origin.

---

\## 4 · Front‑end – `/beta` page
`src/routes/BetaPage.tsx`:

```tsx
import Turnstile from "react-turnstile";
import { useState } from "react";
import { supabase } from "../lib/Auth"; // for SB URL env
import { apiFetch } from "../api";
export default function BetaPage(){
  const [email,setEmail] = useState("");
  const [token,setToken]=useState<string|null>(null);
  const [done,setDone]=useState(false);
  const submit = async()=>{
    if(!token) return alert("Complete CAPTCHA");
    await apiFetch("/waitlist",{method:"POST",body:JSON.stringify({email,token})});
    setDone(true);
  };
  return done?
    <div className="max-w-md mx-auto text-center mt-20">🎉 You’re on the list! We’ll email updates soon.</div>:
    <div className="max-w-md mx-auto mt-20 space-y-4 text-center">
      <h1 className="text-2xl font-bold">Join the Beta Wait‑List</h1>
      <p>Get early access when we expand beyond the first cohort.</p>
      <input type="email" required value={email} onChange={e=>setEmail(e.target.value)} placeholder="you@example.com" className="w-full border p-3 rounded-md"/>
      <Turnstile sitekey={import.meta.env.VITE_TURNSTILE_SITE_KEY} onSuccess={setToken} />
      <button onClick={submit} className="w-full bg-emerald-600 text-white py-2 rounded-md disabled:opacity-50" disabled={!email||!token}>Join Wait‑List</button>
    </div>;
}
```

Install Turnstile component:

```bash
pnpm add react-turnstile
```

Add route in router and footer link: `<a href="/beta">Beta Wait‑List</a>`.

---

\## 5 · SEO & share image
Add meta tags in `index.html` head:

```html
<meta property="og:title" content="Gibsey – Beta Wait‑List"/>
<meta property="og:description" content="Join the next wave of narrative AI explorers."/>
<meta property="og:image" content="/og-beta.png"/>
```

Generate quick OG image with brand name; save in `public/og-beta.png`.

---

\## 6 · Manual test flow

1. Local build (`pnpm run dev`) → `/beta` loads.
2. Enter email, pass captcha → success screen.
3. Supabase table row created with correct email.
4. Duplicate email returns 200 (upsert) but shows success again.

---

\## 7 · Deploy secrets & tag
Add `VITE_TURNSTILE_SITE_KEY` to front‑end Fly secrets:

```bash
fly secrets set VITE_TURNSTILE_SITE_KEY=...
```

Push branch and tag `v0.1.2-alpha` to trigger front‑end deploy.

---

\## 8 · Commit & PR

```bash
git checkout -b day48-beta-waitlist
# add backend route, frontend page, Turnstile dep
git add apps/backend apps/frontend public/og-beta.png
git commit -m "feat: beta wait‑list landing page with Cloudflare Turnstile"
git push -u origin day48-beta-waitlist
```

PR → **Closes #Day-48 issue** → merge when CI passes; move card to **Done**.

---

### ✅ End-of-Day 48 Definition

* `/beta` page collects email into `waitlist` table.
* Turnstile captcha verifies; success screen shown.
* Page deployed to alpha domain; SEO meta ready.

*Tomorrow (Day 49):* Week‑7 retro, Sev‑2 burn‑down, and decide go/no‑go for beta expansion.