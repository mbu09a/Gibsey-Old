# Weekâ€¯1â€¯â€”â€¯Dayâ€¯7 (Vault StubÂ +Â Sprintâ€¯Retro)

> **Target session:**Â â‰ˆâ€¯3â€¯h (2â€¯h buildÂ +Â 1â€¯h reflection)
>
> **Focus:** â‘  create the `vault` table, `/vault/save` endpoint, and a minimal React call; â‘¡ hold a 30â€‘minute retrospective to lock lessons learned and recalibrate Weekâ€¯2.
>
> **Outcome:** pressing **Save toâ€¯Vault** stores the Q\&A pair in Postgres, and you exit Weekâ€¯1 with a clear view of what worked and what slips to Weekâ€¯2.

---

## 0Â Â·Â Schema â€” add `vault` table

Open Supabase SQLÂ editor and run:

```sql
create table if not exists vault (
  id        bigint generated by default as identity primary key,
  user_id   uuid      default '00000000-0000-0000-0000-000000000000', -- anon for now
  page_id   bigint references pages(id) on delete cascade,
  question  text,
  answer    text,
  created_at timestamp with time zone default now()
);

-- optional basic index for later querying
create index if not exists idx_vault_user_ts on vault(user_id, created_at desc);
```

No vector column yet; youâ€™ll decide later if the Vault gets its own embeddings.

---

## 1Â Â·Â Backend â€” `/vault/save` route

### 1.1Â Â DTOs

Append to `app/schemas.py`:

```python
class VaultSaveRequest(BaseModel):
    page_id: int
    question: str
    answer: str
```

### 1.2Â Â Route

In `app/main.py`:

```python
from .schemas import VaultSaveRequest

@app.post("/vault/save", status_code=201)
async def save_to_vault(req: VaultSaveRequest):
    Supabase.client() \
        .table("vault") \
        .insert({
            "page_id": req.page_id,
            "question": req.question,
            "answer": req.answer,
        }) \
        .execute()
    return {"ok": True}
```

No auth yet; anonymous user for Weekâ€¯1.
Reâ€‘build & up backend:

```bash
docker compose -f infra/compose.yaml build backend && docker compose up -d backend
```

---

## 2Â Â·Â Frontend â€” Save button

### 2.1Â Â API helper

`src/lib/api.ts`Â â€” add:

```ts
export async function saveVault(page_id: number, q: string, a: string) {
  const base = import.meta.env.VITE_API_BASE;
  const r = await fetch(`${base}/vault/save`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ page_id, question: q, answer: a }),
  });
  if (!r.ok) throw new Error("Vault save failed");
}
```

### 2.2Â Â UI update

In `src/App.tsx` under the block that renders `answer`, append:

```tsx
{answer && (
  <button
    onClick={() => saveVault(1, question, answer)}
    className="mt-2 px-3 py-1 bg-amber-600 text-white rounded"
  >
    Save toÂ Vault
  </button>
)}
```

Commit:

```bash
git add src/lib/api.ts src/App.tsx
git commit -m "feat: vault save stub"
```

---

## 3Â Â·Â Manual smoke test

1. Refresh **localhost:5173**.
2. Load shard â†’ Ask question â†’ After answer appears, click **Save toÂ Vault**.
3. In Supabase SQL editor:

```sql
select id, question, left(answer,40)||'â€¦' as ans_preview
from vault order by id desc limit 3;
```

Row should be present.

Latency impact: negligible (<â€¯20â€¯ms insert).

---

## 4Â Â·Â CI â€” no change required

Push branch & PR:

```bash
git push -u origin day7-vault-stub
```

Link PR to **â€œDayâ€¯7Â â€“ Vault stubÂ +Â retroâ€** â†’ merge green â†’ move card to *Done*.

---

## 5Â Â·Â 30â€‘min Sprintâ€¯Retro

*(Block calendar immediately after coding.)*

| Prompt                          | Write in READMEâ€‘W1.md Â§Retro                                  |
| ------------------------------- | ------------------------------------------------------------- |
| **What went well?**             | list â‰¥â€¯3 concrete wins (e.g., â€œDocker skeleton never brokeâ€). |
| **What puzzled or slowed you?** | max 3 bullets (e.g., â€œSupabase Python client docs unclearâ€).  |
| **Scope changes?**              | note any tasks that slipped to Weekâ€¯2 column.                 |
| **Latency check:**              | record average `/ask` ms from DevTools.                       |
| **Emotional battery:**          | 1â€“5 rating, gutâ€‘feel.                                         |

Commit retro note:

```bash
git add README-W1.md
git commit -m "docs: add Weekâ€¯1 retro"
```

---

### âœ… End-of-Dayâ€¯7 Definition

* `vault` table + `/vault/save` functional.
* React button triggers insert; verified in DB.
* Weekâ€¯1 retro committed.
* GitHub Project: all Weekâ€¯1 cards in *Done* or moved to Weekâ€¯2 column.

> **Congrats ğŸ** â€” you now have a clickable, databaseâ€‘backed ReadÂ â†’Â AskÂ â†’Â Save loop in six nights. Weekâ€¯2 will tackle multiple shards, real embeddings in `/ask`, and beginning the Vault timeline UI.
